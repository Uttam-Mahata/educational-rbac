<!-- audit-logs.component.html -->
<div class="container-fluid my-4">
    <!-- Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <h2 class="mb-0">Audit Logs</h2>
          <button class="btn btn-primary" (click)="exportLogs()">
            <i class="fas fa-download me-2"></i>Export Logs
          </button>
        </div>
      </div>
    </div>
  
    <!-- Filters -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <form [formGroup]="filterForm" class="row g-3">
              <div class="col-md-2">
                <label class="form-label" id="moduleLabel">Module</label>
                <select class="form-select" formControlName="module" aria-labelledby="moduleLabel">
                  <option *ngFor="let module of modules" [value]="module">
                    {{module}}
                  </option>
                </select>
              </div>
              
              <div class="col-md-2">
                <label class="form-label" id="actionLabel">Action</label>
                <select class="form-select" formControlName="action" aria-labelledby="actionLabel">
                  <option *ngFor="let action of actions" [value]="action">
                    {{action}}
                  </option>
                </select>
              </div>
              
              <div class="col-md-2">
                <label class="form-label" id="userRoleLabel">User Role</label>
                <select class="form-select" formControlName="userRole" aria-labelledby="userRoleLabel">
                  <option *ngFor="let role of userRoles" [value]="role">
                    {{role}}
                  </option>
                </select>
              </div>
              
              <div class="col-md-2">
                <label class="form-label">Start Date</label>
                <input type="date" class="form-control" formControlName="startDate" title="Start Date" placeholder="Select start date">
              </div>
              
              <div class="col-md-2">
                <label class="form-label">End Date</label>
                <input type="date" class="form-control" formControlName="endDate" title="End Date" placeholder="Select end date">
              </div>
              
              <div class="col-md-2">
                <label class="form-label">Search</label>
                <input type="text" class="form-control" formControlName="searchTerm" 
                       placeholder="Search logs...">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Logs Table -->
    <div class="row">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Module</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let log of filteredLogs">
                    <td>{{log.timestamp | date:'medium'}}</td>
                    <td>
                      <div class="d-flex flex-column">
                        <span>{{log.userName}}</span>
                        <small class="text-muted">{{log.userRole}}</small>
                      </div>
                    </td>
                    <td>{{log.action}}</td>
                    <td>{{log.module}}</td>
                    <td>{{log.description}}</td>
                    <td>
                      <span [class]="getStatusClass(log.status)">
                        <i class="fas" [class]="getStatusIcon(log.status)"></i>
                        {{log.status | titlecase}}
                      </span>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary" (click)="viewDetails(log)" title="View Log Details">
                        <i class="fas fa-eye" aria-hidden="true"></i>
                        <span class="visually-hidden">View Log Details</span>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Details Modal -->
  <div class="modal" [class.show]="showDetails" [style.display]="showDetails ? 'block' : 'none'">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Log Details</h5>
          <button type="button" class="btn-close" (click)="closeDetails()" title="Close modal" aria-label="Close modal"></button>
        </div>
        <div class="modal-body" *ngIf="selectedLog">
          <div class="log-details">
            <div class="detail-item">
              <strong>User ID:</strong> {{selectedLog.userId}}
            </div>
            <div class="detail-item">
              <strong>IP Address:</strong> {{selectedLog.ipAddress}}
            </div>
            <div class="detail-item">
              <strong>Browser:</strong> {{selectedLog.details?.browser}}
            </div>
            <div class="detail-item">
              <strong>OS:</strong> {{selectedLog.details?.os}}
            </div>
            <div class="detail-item">
              <strong>Additional Info:</strong>
              <pre>{{selectedLog.details?.additionalInfo}}</pre>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeDetails()">Close</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade show" *ngIf="showDetails"></div>